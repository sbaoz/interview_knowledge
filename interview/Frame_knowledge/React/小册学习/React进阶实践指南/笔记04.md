### setState  
setState(obj, callback)  
第一个参数：当 obj 为一个对象，则为即将合并的 state ；如果 obj 是一个函数，那么当前组件的 state 和 props 将作为参数，返回值用于合并新的 state。  
第二个参数：callback 为一个函数，函数执行上下文中可以获取当前 setState 更新后的最新 state 的值，可以作为依赖 state 变化的副作用函数，可以用来做一些基于 DOM 的操作。

### setState的流程  
1.setState产生当前更新的优先级（expirationTime/lane）
expirationTime: 为防止某个update因为优先级的原因一直被打断而未能执行 React会设置一个expirationTime 当时间到了expirationTime的时候 会强制执行该update  
2.从fiber根部向下调和子节点 调和阶段将对比发生更新的地方 更新对比expirationTime 找到发生更新的组件 合并state 然后出发render函数 得到新的UI视图层 完成render阶段  
3.commit阶段 替换真实DOM 完成更新流程  
4.执行setState中的callback 完成一次setSta过程  

### setState原理 
class组件初始化过程中绑定了负责更新的Updater对象 调用setState方法 实际上是React底层调用Updater对象上的enqueueSetState方法  
- enqueueSetState做了些什么  
创建一个update 然后放入当前fiber对象的等待更新队列中 最后开启调度更新 进入setState更新流程
- React底层是如何进行批量更新的  
正常state更新、UI交互都离不开用户的事件 React是采用事件合成的形式 每一个事件都是由React事件系统统一调度 State批量更新和事件系统息息相关  
在legacy模式下 所有的事件都是经过dispatchEventForLegacyPluginEventSystem函数统一处理  
在batchedEventUpdates方法中 通过 isBatchingEventUpdates = true; 开启批量更新  
当该事件结束时 再通过 isBatchingEventUpdates = false; 关闭批量更新  
在scheduleUpdateOnFiber函数中根据这个开关来确定是否进行批量更新  

### 问答  
问：class组件如何限制state更新视图  
答：  
1.pureComponent可以对state和props进行浅比较 如果没有发生变化 那么组件不更新  
2.shouldComponentUpdate生命周期可以通过判断前后state变化来决定组件需不需要更新 需要更新返回true 否则返回false  
