<!--
 * @Author: sbaoz xiaojz821@hotmail.com
 * @Date: 2022-07-12 15:07:54
 * @LastEditors: sbaoz xiaojz821@hotmail.com
 * @LastEditTime: 2022-07-12 17:33:31
 * @FilePath: \interview_knowledge\interview\Engineering_knowledge\学习笔记\深入浅出Vite\笔记\03.实践.md
 * @Description: 这是默认设置,请设置`customMade`, 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE
-->
### 初始化Vite项目
pnpm create vite 初始化项目  
"preview": "vite preview" 生产环境打包完后预览产物

### 接入CSS工程化方案
- 样式方案的意义
  - 优化开发体验
  - 解决样式污染问题
  - 解决浏览器兼容问题
  - 压缩产物体积
- 常见的5类解决方案
  - CSS预处理器  
    Sass/Scss、Less和Stylus 可以使用嵌套规则 定义变量 条件判断 循环语句 解决了原生CSS的开发体验问题  
  - CSS Modules  
    将CSS类名处理成哈希值 解决同名情况下的样式污染问题
  - CSS后处理器  
    PostCSS 用来解析和处理CSS代码 功能丰富 px转rem 自动加浏览器前缀等
  - CSS in JS  
    emotion、styled-components 在JS中直接写样式代码 实现CSS预处理器和CSS Modules的功能  
  - CSS原子化框架  
    Tailwind CSS、Windi CSS 通过类名来指定样式 简化样式写法 提高样式开发效率  

#### 接入CSS预处理器  
Vite内置了各种CSS预处理器语言 可以零配置使用 但是为了实现按需加载 Vite并没有内置这些工具库 需要用户按需安装 相关配置查询如下  
[Sass](https://sass-lang.com/documentation/js-api/modules#render)
[Less](https://lesscss.org/usage/#less-options)
[Stylus](https://stylus-lang.com/docs/js.html)

#### 接入CSS Modules
CSS Modules在Vite中开箱即用 Vite会对后缀带有.module的样式文件自动应用CSS Modules  
[CSS Modules](https://github.com/madyankin/postcss-modules)

#### 接入PostCSS
可以通过postcss.config.js来配置PostCSS 也可以在Vite配置文件中进行配置  
常用的插件  
- autoprefixer 为不同的目标浏览器添加样式前缀 解决浏览器兼容问题  
- postcss-pxtorem px转换rem
- postcss-preset-env 编写最新的css语法 不用担心兼容问题
- cssnano 压缩CSS代码  
[PostCSS插件](https://www.postcss.parts/)

#### 接入CSS in JS
两款主流的CSS In JS 方案: styled-components和emotion  
集成方式如下  
``` ts
// vite.config.ts
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [
    react({
      babel: {
        // 加入 babel 插件
        // 以下插件包都需要提前安装
        // 当然，通过这个配置你也可以添加其它的 Babel 插件
        plugins: [
          // 适配 styled-component
          "babel-plugin-styled-components"
          // 适配 emotion
          "@emotion/babel-plugin"
        ]
      },
      // 注意: 对于 emotion，需要单独加上这个配置
      // 通过 `@emotion/react` 包编译 emotion 中的特殊 jsx 语法
      jsxImportSource: "@emotion/react"
    })
  ]
})
```
### CSS原子化框架
#### Windi CSS接入
pnpm i windicss vite-plugin-windicss -D 安装windicss和对应的Vite插件  
注意在src/main.tsx中引入一个必需的 import 语句: import "virtual:windi.css";  
开启attributify 和 shortcuts 需要在根目录新建windi.config.ts  
使用attributity需要注意类型问题 添加types/shim.d.ts 防止类型报错  
使用shortcuts来封装一系列的原子化能力，尤其是一些常见的类名集合  
#### Tailwind CSS接入
pnpm install -D tailwindcss postcss autoprefixer 安装 tailwindcss 及其必要的依赖  
新建两个配置文件tailwind.config.js和postcss.config.js  
```js
// tailwind.config.js
module.exports = {
  content: [
    "./index.html",
    "./src/**/*.{vue,js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
}

// postcss.config.js
// 从中你可以看到，Tailwind CSS 的编译能力是通过 PostCSS 插件实现的
// 而 Vite 本身内置了 PostCSS，因此可以通过 PostCSS 配置接入 Tailwind CSS 
// 注意: Vite 配置文件中如果有 PostCSS 配置的情况下会覆盖掉 post.config.js 的内容!
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
```
在项目的入口 CSS 中引入必要的样板代码  
```css
@tailwind base;
@tailwind components;
@tailwind utilities;
```
使用 Tailwind 样式
```tsx
import logo from "./logo.svg";
import "./App.css";

function App() {
  return (
    <div>
      <header className="App-header">
        <img src={logo} className="w-20" alt="logo" />
        <p className="bg-red-400">Hello Vite + React!</p>
      </header>
    </div>
  );
}

export default App;
```